AWSTemplateFormatVersion: "2010-09-09"
Transform: "AWS::Serverless-2016-10-31"

Parameters:
    # デプロイ先環境の設定
    EnvironmentType:
        Type: "String"
        AllowedValues: ["dev", "prod"]

Conditions:
    # 本番環境かどうか
    IsProd: !Equals [!Ref "EnvironmentType", "prod"]

Resources:
    # S3エラーログ用バケット
    - $file: resources/s3/error_logs.yml

    # Lambdaレイヤー - check_area_code_names
    - $file: resources/lambda_layers/check_area_code_names.yml
    # Lambdaレイヤー - dynamodb_types
    - $file: resources/lambda_layers/dynamodb_types.yml

    # EventBridgeスケジュールグループ
    - $file: resources/eventbridge/schedule_group.yml

    # Lambda - LINE通知
    - $file: resources/line_notify/lambda.yml
    - $file: resources/line_notify/iam_role.yml
    - $file: resources/line_notify/iam_policy.yml

    # Lambda - エラー共通処理
    - $file: resources/error_common/lambda.yml
    - $file: resources/error_common/iam_role.yml
    - $file: resources/error_common/iam_policy.yml

    # Lambda - スケジュール登録
    - $file: resources/register_schedules/lambda.yml
    - $file: resources/register_schedules/iam_role.yml
    - $file: resources/register_schedules/iam_policy.yml

    # EventBridge - スケジュール登録
    - $file: resources/invoke_register_schedules/iam_role.yml
    - $file: resources/invoke_register_schedules/iam_policy.yml

    # EventBridge - 概要情報スクレイピングタスクの登録（小エリアごと）
    - $file: resources/invoke_register_small_areas/iam_role.yml
    - $file: resources/invoke_register_small_areas/iam_policy.yml

    # Lambda - 概要情報スクレイピングタスクの登録（小エリアごと）
    - $file: resources/register_small_areas/lambda.yml
    - $file: resources/register_small_areas/iam_role.yml
    - $file: resources/register_small_areas/iam_policy.yml

    # EventBridge - 概要情報スクレイピングタスクの登録（ページごと）
    - $file: resources/invoke_register_abstract_pages/iam_role.yml
    - $file: resources/invoke_register_abstract_pages/iam_policy.yml

    # Lambda - 概要情報スクレイピングタスクの登録（ページごと）
    - $file: resources/register_abstract_pages/lambda.yml
    - $file: resources/register_abstract_pages/iam_role.yml
    - $file: resources/register_abstract_pages/iam_policy.yml

    # EventBridge - 概要情報スクレイピング
    - $file: resources/invoke_scraping_abstract/iam_role.yml
    - $file: resources/invoke_scraping_abstract/iam_policy.yml

    # Lambda - 概要情報スクレイピング
    - $file: resources/scraping_abstract/lambda.yml
    - $file: resources/scraping_abstract/iam_role.yml
    - $file: resources/scraping_abstract/iam_policy.yml

    # EventBridge - 詳細情報スクレイピング
    - $file: resources/invoke_scraping_detail/iam_role.yml
    - $file: resources/invoke_scraping_detail/iam_policy.yml

    # Lambda - 詳細情報スクレイピング
    - $file: resources/scraping_detail/lambda.yml
    - $file: resources/scraping_detail/iam_role.yml
    - $file: resources/scraping_detail/iam_policy.yml

    # Lambda - 新規の飲食店通知
    - $file: resources/notify_new_shops/lambda.yml
    - $file: resources/notify_new_shops/iam_role.yml
    - $file: resources/notify_new_shops/iam_policy.yml

    # DynamoDB
    - $file: resources/dynamodb/restaurants.yml
    - $file: resources/dynamodb/restaurants_areas.yml
    - $file: resources/dynamodb/restaurants_tasks_tmp.yml

Outputs:
    # LINE通知LambdaのARN
    ArnLambdaLineNotify:
        Value: !GetAtt "LambdaLineNotify.Arn"
        Export:
            Name: "ARN-LambdaLineNotify"

    # エラー共通処理LambdaのARN
    ArnLambdaErrorCommon:
        Value: !GetAtt "LambdaErrorCommon.Arn"
        Export:
            Name: "ARN-LambdaErrorCommon"

    # スケジュール登録LambdaのARN
    ArnLambdaRegisterSchedules:
        Value: !GetAtt "LambdaRegisterSchedules.Arn"
        Export:
            Name: "ARN-LambdaRegisterSchedule"

    # 概要情報スクレイピングタスクの登録（小エリアごと）LambdaのARN
    ArnLambdaRegisterSmallAreas:
        Value: !GetAtt "LambdaRegisterSmallAreas.Arn"
        Export:
            Name: "ARN-LambdaRegisterSmallAreas"

    # 概要情報スクレイピングタスクの登録（ページごと）LambdaのARN
    ArnLambdaRegisterAbstractPages:
        Value: !GetAtt "LambdaRegisterAbstractPages.Arn"
        Export:
            Name: "ARN-LambdaRegisterAbstractPages"

    # 概要情報スクレイピングLambdaのARN
    ArnScrapingAbstract:
        Value: !GetAtt "LambdaScrapingAbstract.Arn"
        Export:
            Name: "ARN-ScrapingAbstract"

    # 詳細情報スクレイピングLambdaのARN
    ArnScrapingDetail:
        Value: !GetAtt "LambdaScrapingDetail.Arn"
        Export:
            Name: "ARN-ScrapingDetail"